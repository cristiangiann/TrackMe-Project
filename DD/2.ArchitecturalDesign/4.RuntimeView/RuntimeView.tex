\documentclass[../../DD.tex]{subfiles}
\begin{document}
\section{Runtime View\label{sect:2.4}}
\indent The following is a representation through sequence diagrams of the main functions and processes of the system to be. The actors of the diagrams are the components represented in section \hyperref[sect:2.2]{2.2}.\\ \\
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% DATA4HELP %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	\image {13cm} {Sequence_Diagrams/SequenceDiagramLogin.jpg} {Login Sequence Diagram} {LoginSequenceDiagram}
	In this sequence diagram the \ic{User} login on the User Application is shown. The component involved in the process is the Authentication, which checks the credentials inserted by the \ic{User}.

	\image {13cm} {Sequence_Diagrams/SequenceDiagramNotifications.jpg} {Notifications Sequence Diagram} {NotificationsSequenceDiagram}
	The User Application is able to receive notifications from Data4Help by querying the server side Application for new notifications. The Services Manager asks the Notifications Manager for new notifications. If there are any new notifications for the \ic{User}, then it returns them, otherwise it tells the Services Manager that there are no new notifications.

	\image {13cm} {Sequence_Diagrams/SequenceDiagramUserDataRequest.jpg} {User Data Request Sequence Diagram} {UserDataRequestSequenceDiagram}
	A \ic{Third party} may request access to a specific \ic{User data}. It sends a request to the Third Party Request Manager, which forwards it to the Data Manager. This last component queries the database for \ic{User data}. Assuming that the query returns non-empty \ic{User data}, the Third Party Request Manager gets the data and checks if the \ic{User} gave consent to the specific \ic{Third party Service} that is requesting their data. If the consent was granted, then the \ic{User data} is sent to the Third Party Service System. Otherwise, the Third Party Request Manager asks the Notifications Manager to add a new notification for that \ic{User}, which is then stored in the database. The notification refers to the fact that the \ic{Third party Service} wants to acquire their data.

	\image {13cm} {Sequence_Diagrams/SequenceDiagramGroupDataRequest.jpg} {Group Data Request Sequence Diagram} {GroupDataRequestSequenceDiagram}
	When performing a \ic{Group data} request, the \ic{Third party} sends a request from the Third Party Service System to the Third Party Request Manager of Data4Help. This last component asks the Data Manager for group data, which queries the database for data. The \ic{Group data} is sent back to the Third Party Request Manager, which checks the cardinality. If the data refers to more than 1000 \ic{Users}, the data is anonymized and sent to the Third Party Service System which made the request. Otherwise, a request denial is sent back.
	
	\image {13cm} {Sequence_Diagrams/SequenceDiagramAddNewService.jpg} {Add New Service Sequence Diagram} {AddNewServiceSequenceDiagram}
	When a \ic{User} wants to add a new \ic{Service}, the User Application Services Manager sends a request for available \ic{Services} to Data4Help. The request is received by the Services Manager that forwards it to the Data Manager, which queries the database. The list of \ic{Services} is sent back to the User Application. The \ic{User} then selects a \ic{Service} and its details are returned to the User Application by Data4Help. If the \ic{User} decides to add the \ic{Service} and give consent to their data acquisition by the Third party, then it sends the choice to the Services Manager. This last one forwards the information to the Data Manager, which stores the consent in the database, together with adding the \ic{Service} to the list of \ic{Services} for the specific \ic{User}. Moreover, the Services Manager sends a consent notification to the Third Party Service System. A confirmation is sent back to the User Application.

	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% AUTOMATEDSOS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


	\image {13cm} {Sequence_Diagrams/SequenceDiagramUserInNeedAssistance.jpg} {User In Need Assistance Sequence Diagram} {UserInNeedAssistanceSequenceDiagram}
	When new \ic{User data} is collected by Data4Help, if the \ic{User} is subscribed to AutomatedSOS, the data will be sent to AutomatedSOS for analysis. In particular, the Data Receiver will receive the data, and will pass it over to the Data Analyzer which compares it against certain thresholds. If the data is identified as \ic{Anomalous data}, then the Data Analyzer notifies the User Monitor that the \ic{User} is in need of assistance. The User Monitor sends a call request to the Local Emergency Services Caller, which calls the Local Emergency Services. This component sends a call confirmation back to the User Monitor and finally the User Monitor stores the \ic{User in need} data in the database.
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% TRACK4RUN %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	\image {13cm} {Sequence_Diagrams/SequenceDiagramOrganizeRun.jpg} {Run Organization Sequence Diagram} {RunOrganizationSequenceDiagram}
	When they want to organize a \ic{Run}, \ic{Organizers} login into their dedicated website and send a \ic{Run} creation request to the Run Manager of Track4Run. This last one checks the \ic{Run} data is correct and if it is, it creates the \ic{Run}.

	\image {13cm} {Sequence_Diagrams/SequenceDiagramParticipantEnrollment.jpg} {Participant Enrollment Sequence Diagram} {ParticipantEnrollmentSequenceDiagram}
	In this diagram the \ic{Participant} enrollment process is shown in details. A \ic{User} who wants to enroll in a \ic{Run} needs to first have all the available \ic{Runs}. This is done by querying the Service Interface Provider through the Service Interface. The Service Interface Provider forwards the User Application requests to the Run Manager, which queries the database. It returns the list of available \ic{Runs} to the User Application. Assuming that the list is not empty, the \ic{User} will express their selection and the Data4Help components will return the \ic{Run} details. The \ic{User} may then select to enroll in the selected \ic{Run}. The Run Manager is in charge of checking if the \ic{User} can enroll or not - the latter may happen because the enrollment is closed. If the \ic{User} can enroll in the \ic{Run}, the Run Manager saves the enrollment in the database and sends a confirmation to the User Application. Otherwise, an enrollment denial is sent back.

\end{document}
